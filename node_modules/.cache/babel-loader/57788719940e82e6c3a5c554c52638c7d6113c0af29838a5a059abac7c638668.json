{"ast":null,"code":"// Filename - App.js\n\nconst express = require(\"express\"),\n  mongoose = require(\"mongoose\"),\n  passport = require(\"passport\"),\n  bodyParser = require(\"body-parser\"),\n  LocalStrategy = require(\"passport-local\"),\n  passportLocalMongoose = require(\"passport-local-mongoose\");\nconst User = require(\"./model/User\");\nlet app = express();\nmongoose.connect(\"mongodb://localhost/27017\");\napp.set(\"view engine\", \"ejs\");\napp.use(bodyParser.urlencoded({\n  extended: true\n}));\napp.use(require(\"express-session\")({\n  secret: \"Rusty is a dog\",\n  resave: false,\n  saveUninitialized: false\n}));\napp.use(passport.initialize());\napp.use(passport.session());\npassport.use(new LocalStrategy(User.authenticate()));\npassport.serializeUser(User.serializeUser());\npassport.deserializeUser(User.deserializeUser());\n\n//=====================\n// ROUTES\n//=====================\n\n// Showing home page\napp.get(\"/\", function (req, res) {\n  res.render(\"home\");\n});\n\n// Showing secret page\napp.get(\"/secret\", isLoggedIn, function (req, res) {\n  res.render(\"secret\");\n});\n\n// Showing register form\napp.get(\"/register\", function (req, res) {\n  res.render(\"register\");\n});\n\n// Handling user signup\napp.post(\"/register\", async (req, res) => {\n  const user = await User.create({\n    username: req.body.username,\n    password: req.body.password\n  });\n  return res.status(200).json(user);\n});\n\n//Showing login form\napp.get(\"/login\", function (req, res) {\n  res.render(\"login\");\n});\n\n//Handling user login\napp.post(\"/login\", async function (req, res) {\n  try {\n    // check if the user exists\n    const user = await User.findOne({\n      username: req.body.username\n    });\n    if (user) {\n      //check if password matches\n      const result = req.body.password === user.password;\n      if (result) {\n        res.render(\"secret\");\n      } else {\n        res.status(400).json({\n          error: \"password doesn't match\"\n        });\n      }\n    } else {\n      res.status(400).json({\n        error: \"User doesn't exist\"\n      });\n    }\n  } catch (error) {\n    res.status(400).json({\n      error\n    });\n  }\n});\n\n//Handling user logout \napp.get(\"/logout\", function (req, res) {\n  req.logout(function (err) {\n    if (err) {\n      return next(err);\n    }\n    res.redirect('/');\n  });\n});\nfunction isLoggedIn(req, res, next) {\n  if (req.isAuthenticated()) return next();\n  res.redirect(\"/login\");\n}\nlet port = process.env.PORT || 3000;\napp.listen(port, function () {\n  console.log(\"Server Has Started!\");\n});","map":{"version":3,"names":["express","require","mongoose","passport","bodyParser","LocalStrategy","passportLocalMongoose","User","app","connect","set","use","urlencoded","extended","secret","resave","saveUninitialized","initialize","session","authenticate","serializeUser","deserializeUser","get","req","res","render","isLoggedIn","post","user","create","username","body","password","status","json","findOne","result","error","logout","err","next","redirect","isAuthenticated","port","process","env","PORT","listen","console","log"],"sources":["D:/MERN/github folder/wt project/exercise-tracker/src/loginComp.js"],"sourcesContent":["// Filename - App.js\r\n\r\nconst express = require(\"express\"),\r\n\tmongoose = require(\"mongoose\"),\r\n\tpassport = require(\"passport\"),\r\n\tbodyParser = require(\"body-parser\"),\r\n\tLocalStrategy = require(\"passport-local\"),\r\n\tpassportLocalMongoose = \r\n\t\trequire(\"passport-local-mongoose\")\r\nconst User = require(\"./model/User\");\r\nlet app = express();\r\n\r\nmongoose.connect(\"mongodb://localhost/27017\");\r\n\r\napp.set(\"view engine\", \"ejs\");\r\napp.use(bodyParser.urlencoded({ extended: true }));\r\napp.use(require(\"express-session\")({\r\n\tsecret: \"Rusty is a dog\",\r\n\tresave: false,\r\n\tsaveUninitialized: false\r\n}));\r\n\r\napp.use(passport.initialize());\r\napp.use(passport.session());\r\n\r\npassport.use(new LocalStrategy(User.authenticate()));\r\npassport.serializeUser(User.serializeUser());\r\npassport.deserializeUser(User.deserializeUser());\r\n\r\n//=====================\r\n// ROUTES\r\n//=====================\r\n\r\n// Showing home page\r\napp.get(\"/\", function (req, res) {\r\n\tres.render(\"home\");\r\n});\r\n\r\n// Showing secret page\r\napp.get(\"/secret\", isLoggedIn, function (req, res) {\r\n\tres.render(\"secret\");\r\n});\r\n\r\n// Showing register form\r\napp.get(\"/register\", function (req, res) {\r\n\tres.render(\"register\");\r\n});\r\n\r\n// Handling user signup\r\napp.post(\"/register\", async (req, res) => {\r\n\tconst user = await User.create({\r\n\tusername: req.body.username,\r\n\tpassword: req.body.password\r\n\t});\r\n\r\n\treturn res.status(200).json(user);\r\n});\r\n\r\n//Showing login form\r\napp.get(\"/login\", function (req, res) {\r\n\tres.render(\"login\");\r\n});\r\n\r\n//Handling user login\r\napp.post(\"/login\", async function(req, res){\r\n\ttry {\r\n\t\t// check if the user exists\r\n\t\tconst user = await User.findOne({ username: req.body.username });\r\n\t\tif (user) {\r\n\t\t//check if password matches\r\n\t\tconst result = req.body.password === user.password;\r\n\t\tif (result) {\r\n\t\t\tres.render(\"secret\");\r\n\t\t} else {\r\n\t\t\tres.status(400).json({ error: \"password doesn't match\" });\r\n\t\t}\r\n\t\t} else {\r\n\t\tres.status(400).json({ error: \"User doesn't exist\" });\r\n\t\t}\r\n\t} catch (error) {\r\n\t\tres.status(400).json({ error });\r\n\t}\r\n});\r\n\r\n//Handling user logout \r\napp.get(\"/logout\", function (req, res) {\r\n\treq.logout(function(err) {\r\n\t\tif (err) { return next(err); }\r\n\t\tres.redirect('/');\r\n\t});\r\n});\r\n\r\n\r\n\r\nfunction isLoggedIn(req, res, next) {\r\n\tif (req.isAuthenticated()) return next();\r\n\tres.redirect(\"/login\");\r\n}\r\n\r\nlet port = process.env.PORT || 3000;\r\napp.listen(port, function () {\r\n\tconsole.log(\"Server Has Started!\");\r\n});\r\n"],"mappings":"AAAA;;AAEA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;EACjCC,QAAQ,GAAGD,OAAO,CAAC,UAAU,CAAC;EAC9BE,QAAQ,GAAGF,OAAO,CAAC,UAAU,CAAC;EAC9BG,UAAU,GAAGH,OAAO,CAAC,aAAa,CAAC;EACnCI,aAAa,GAAGJ,OAAO,CAAC,gBAAgB,CAAC;EACzCK,qBAAqB,GACpBL,OAAO,CAAC,yBAAyB,CAAC;AACpC,MAAMM,IAAI,GAAGN,OAAO,CAAC,cAAc,CAAC;AACpC,IAAIO,GAAG,GAAGR,OAAO,CAAC,CAAC;AAEnBE,QAAQ,CAACO,OAAO,CAAC,2BAA2B,CAAC;AAE7CD,GAAG,CAACE,GAAG,CAAC,aAAa,EAAE,KAAK,CAAC;AAC7BF,GAAG,CAACG,GAAG,CAACP,UAAU,CAACQ,UAAU,CAAC;EAAEC,QAAQ,EAAE;AAAK,CAAC,CAAC,CAAC;AAClDL,GAAG,CAACG,GAAG,CAACV,OAAO,CAAC,iBAAiB,CAAC,CAAC;EAClCa,MAAM,EAAE,gBAAgB;EACxBC,MAAM,EAAE,KAAK;EACbC,iBAAiB,EAAE;AACpB,CAAC,CAAC,CAAC;AAEHR,GAAG,CAACG,GAAG,CAACR,QAAQ,CAACc,UAAU,CAAC,CAAC,CAAC;AAC9BT,GAAG,CAACG,GAAG,CAACR,QAAQ,CAACe,OAAO,CAAC,CAAC,CAAC;AAE3Bf,QAAQ,CAACQ,GAAG,CAAC,IAAIN,aAAa,CAACE,IAAI,CAACY,YAAY,CAAC,CAAC,CAAC,CAAC;AACpDhB,QAAQ,CAACiB,aAAa,CAACb,IAAI,CAACa,aAAa,CAAC,CAAC,CAAC;AAC5CjB,QAAQ,CAACkB,eAAe,CAACd,IAAI,CAACc,eAAe,CAAC,CAAC,CAAC;;AAEhD;AACA;AACA;;AAEA;AACAb,GAAG,CAACc,GAAG,CAAC,GAAG,EAAE,UAAUC,GAAG,EAAEC,GAAG,EAAE;EAChCA,GAAG,CAACC,MAAM,CAAC,MAAM,CAAC;AACnB,CAAC,CAAC;;AAEF;AACAjB,GAAG,CAACc,GAAG,CAAC,SAAS,EAAEI,UAAU,EAAE,UAAUH,GAAG,EAAEC,GAAG,EAAE;EAClDA,GAAG,CAACC,MAAM,CAAC,QAAQ,CAAC;AACrB,CAAC,CAAC;;AAEF;AACAjB,GAAG,CAACc,GAAG,CAAC,WAAW,EAAE,UAAUC,GAAG,EAAEC,GAAG,EAAE;EACxCA,GAAG,CAACC,MAAM,CAAC,UAAU,CAAC;AACvB,CAAC,CAAC;;AAEF;AACAjB,GAAG,CAACmB,IAAI,CAAC,WAAW,EAAE,OAAOJ,GAAG,EAAEC,GAAG,KAAK;EACzC,MAAMI,IAAI,GAAG,MAAMrB,IAAI,CAACsB,MAAM,CAAC;IAC/BC,QAAQ,EAAEP,GAAG,CAACQ,IAAI,CAACD,QAAQ;IAC3BE,QAAQ,EAAET,GAAG,CAACQ,IAAI,CAACC;EACnB,CAAC,CAAC;EAEF,OAAOR,GAAG,CAACS,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAACN,IAAI,CAAC;AAClC,CAAC,CAAC;;AAEF;AACApB,GAAG,CAACc,GAAG,CAAC,QAAQ,EAAE,UAAUC,GAAG,EAAEC,GAAG,EAAE;EACrCA,GAAG,CAACC,MAAM,CAAC,OAAO,CAAC;AACpB,CAAC,CAAC;;AAEF;AACAjB,GAAG,CAACmB,IAAI,CAAC,QAAQ,EAAE,gBAAeJ,GAAG,EAAEC,GAAG,EAAC;EAC1C,IAAI;IACH;IACA,MAAMI,IAAI,GAAG,MAAMrB,IAAI,CAAC4B,OAAO,CAAC;MAAEL,QAAQ,EAAEP,GAAG,CAACQ,IAAI,CAACD;IAAS,CAAC,CAAC;IAChE,IAAIF,IAAI,EAAE;MACV;MACA,MAAMQ,MAAM,GAAGb,GAAG,CAACQ,IAAI,CAACC,QAAQ,KAAKJ,IAAI,CAACI,QAAQ;MAClD,IAAII,MAAM,EAAE;QACXZ,GAAG,CAACC,MAAM,CAAC,QAAQ,CAAC;MACrB,CAAC,MAAM;QACND,GAAG,CAACS,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAAEG,KAAK,EAAE;QAAyB,CAAC,CAAC;MAC1D;IACA,CAAC,MAAM;MACPb,GAAG,CAACS,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEG,KAAK,EAAE;MAAqB,CAAC,CAAC;IACrD;EACD,CAAC,CAAC,OAAOA,KAAK,EAAE;IACfb,GAAG,CAACS,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAAEG;IAAM,CAAC,CAAC;EAChC;AACD,CAAC,CAAC;;AAEF;AACA7B,GAAG,CAACc,GAAG,CAAC,SAAS,EAAE,UAAUC,GAAG,EAAEC,GAAG,EAAE;EACtCD,GAAG,CAACe,MAAM,CAAC,UAASC,GAAG,EAAE;IACxB,IAAIA,GAAG,EAAE;MAAE,OAAOC,IAAI,CAACD,GAAG,CAAC;IAAE;IAC7Bf,GAAG,CAACiB,QAAQ,CAAC,GAAG,CAAC;EAClB,CAAC,CAAC;AACH,CAAC,CAAC;AAIF,SAASf,UAAUA,CAACH,GAAG,EAAEC,GAAG,EAAEgB,IAAI,EAAE;EACnC,IAAIjB,GAAG,CAACmB,eAAe,CAAC,CAAC,EAAE,OAAOF,IAAI,CAAC,CAAC;EACxChB,GAAG,CAACiB,QAAQ,CAAC,QAAQ,CAAC;AACvB;AAEA,IAAIE,IAAI,GAAGC,OAAO,CAACC,GAAG,CAACC,IAAI,IAAI,IAAI;AACnCtC,GAAG,CAACuC,MAAM,CAACJ,IAAI,EAAE,YAAY;EAC5BK,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAC;AACnC,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}